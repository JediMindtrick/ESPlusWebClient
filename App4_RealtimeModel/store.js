var store = { 
    TestOrg: { 
        "PerfRuns":{"List":{"0dca3e5a-7792-43f5-98e8-a03b2c88ae4e":{"_metadata":{"eventType":"PerfRunStart","streamClientSent":1415706628045,"perfStreamReceived":1415706624699,"perfBeginCommit":1415706624699,"streamOrder":336,"eventId":"0ddd91b5-9e5c-4650-bce1-34fd44e0b4e6","streamId":"AppTestStream","perfEndCommit":1415706624701,"perfPublishEvent":1415706624703,"perfPublishReceived":1415706624703,"perfSendToStore":1415706624704,"perfStoreReceived":1415706624705,"perfNotifyModelChange":1415706624705},"report":{"startTime":1415706628044,"endTime":null,"received":0,"runId":"0dca3e5a-7792-43f5-98e8-a03b2c88ae4e","max":10},"sets":[],"data":[]}},"Completed":{"0dca3e5a-7792-43f5-98e8-a03b2c88ae4e":{"_metadata":{"eventType":"PerfRunEnd","streamClientSent":1415706628173,"perfStreamReceived":1415706624847,"perfBeginCommit":1415706624847,"streamOrder":339,"eventId":"fd40c854-85ea-4a31-9e17-1e6adedd8ef1","streamId":"AppTestStream","perfEndCommit":1415706624849,"perfPublishEvent":1415706624851,"perfPublishReceived":1415706624851,"perfSendToStore":1415706624851,"perfStoreReceived":1415706624852,"perfNotifyModelChange":1415706624852},"report":{"startTime":1415706628044,"endTime":1415706628172,"received":10,"runId":"0dca3e5a-7792-43f5-98e8-a03b2c88ae4e","max":10,"sendToStream":303.2,"between1":0,"writeToDisk":17,"between2":5.6,"sendToBLP":0.4,"blpLogic":0,"sendToStore":1.6,"setModel":0,"sendToClient":3369.6,"totalTime":3697.4,"elapsedSec":0.128,"totalRecords":10,"recordsPerSec":78.125},"sets":["4bbbd3f7-4e5a-46af-9ca3-395b0070fcdd"],"data":[{"perfClientSent":1415706624446,"startPerfRun":true,"runSize":10,"streamClientSent":1415706624447,"perfStreamReceived":1415706624670,"perfBeginCommit":1415706624670,"streamOrder":12052,"eventId":"207a2826-7788-41dd-8abc-4991b3477a83","streamId":"AppTestStream","perfEndCommit":1415706624673,"perfPublishEvent":1415706624675,"perfPublishReceived":1415706624676,"perfSendToStore":1415706624676,"perfStoreReceived":1415706624676,"perfNotifyModelChange":1415706624676,"perfClientReceived":1415706628045,"TotalTime":3599,"SendToStream":224,"Between1":0,"WriteToDisk":3,"Between2":2,"SendToBLP":1,"BLPlogic":0,"SendToStore":0,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624446,"startPerfRun":true,"runSize":10,"streamClientSent":1415706624447,"perfStreamReceived":1415706624670,"perfBeginCommit":1415706624670,"streamOrder":12052,"eventId":"207a2826-7788-41dd-8abc-4991b3477a83","streamId":"AppTestStream","perfEndCommit":1415706624673,"perfPublishEvent":1415706624675,"perfPublishReceived":1415706624676,"perfSendToStore":1415706624676,"perfStoreReceived":1415706624676,"perfNotifyModelChange":1415706624676,"perfClientReceived":1415706628045,"TotalTime":3599,"SendToStream":224,"Between1":0,"WriteToDisk":3,"Between2":2,"SendToBLP":1,"BLPlogic":0,"SendToStore":0,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624768,"perfBeginCommit":1415706624768,"streamOrder":12053,"eventId":"8540803d-8c31-4995-bd58-f7d60c0f9076","streamId":"AppTestStream","perfEndCommit":1415706624791,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624800,"perfNotifyModelChange":1415706624800,"perfClientReceived":1415706628169,"TotalTime":3720,"SendToStream":319,"Between1":0,"WriteToDisk":23,"Between2":8,"SendToBLP":0,"BLPlogic":0,"SendToStore":1,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624768,"perfBeginCommit":1415706624768,"streamOrder":12053,"eventId":"8540803d-8c31-4995-bd58-f7d60c0f9076","streamId":"AppTestStream","perfEndCommit":1415706624791,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624800,"perfNotifyModelChange":1415706624800,"perfClientReceived":1415706628169,"TotalTime":3720,"SendToStream":319,"Between1":0,"WriteToDisk":23,"Between2":8,"SendToBLP":0,"BLPlogic":0,"SendToStore":1,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624771,"perfBeginCommit":1415706624771,"streamOrder":12054,"eventId":"31af30c6-9fc0-463c-946b-b6ad21728ad1","streamId":"AppTestStream","perfEndCommit":1415706624792,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624801,"perfNotifyModelChange":1415706624801,"perfClientReceived":1415706628171,"TotalTime":3722,"SendToStream":322,"Between1":0,"WriteToDisk":21,"Between2":7,"SendToBLP":0,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624771,"perfBeginCommit":1415706624771,"streamOrder":12054,"eventId":"31af30c6-9fc0-463c-946b-b6ad21728ad1","streamId":"AppTestStream","perfEndCommit":1415706624792,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624801,"perfNotifyModelChange":1415706624801,"perfClientReceived":1415706628171,"TotalTime":3722,"SendToStream":322,"Between1":0,"WriteToDisk":21,"Between2":7,"SendToBLP":0,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624773,"perfBeginCommit":1415706624773,"streamOrder":12055,"eventId":"a79e5d64-6f10-4b6c-93f9-a11bd4a2af50","streamId":"AppTestStream","perfEndCommit":1415706624793,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":324,"Between1":0,"WriteToDisk":20,"Between2":6,"SendToBLP":0,"BLPlogic":0,"SendToStore":3,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624773,"perfBeginCommit":1415706624773,"streamOrder":12055,"eventId":"a79e5d64-6f10-4b6c-93f9-a11bd4a2af50","streamId":"AppTestStream","perfEndCommit":1415706624793,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":324,"Between1":0,"WriteToDisk":20,"Between2":6,"SendToBLP":0,"BLPlogic":0,"SendToStore":3,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624776,"perfBeginCommit":1415706624776,"streamOrder":12056,"eventId":"ac10e31b-99ea-40ee-ac63-86bb5c692235","streamId":"AppTestStream","perfEndCommit":1415706624794,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624800,"perfSendToStore":1415706624800,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":327,"Between1":0,"WriteToDisk":18,"Between2":5,"SendToBLP":1,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624776,"perfBeginCommit":1415706624776,"streamOrder":12056,"eventId":"ac10e31b-99ea-40ee-ac63-86bb5c692235","streamId":"AppTestStream","perfEndCommit":1415706624794,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624800,"perfSendToStore":1415706624800,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":327,"Between1":0,"WriteToDisk":18,"Between2":5,"SendToBLP":1,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370}]}}},"PerfSets":{"List":{"4bbbd3f7-4e5a-46af-9ca3-395b0070fcdd":{"_metadata":{"eventType":"PerfSetStart","streamClientSent":1415706628045,"perfStreamReceived":1415706624700,"perfBeginCommit":1415706624700,"streamOrder":337,"eventId":"1cc2bd6b-4cde-4d62-8acc-a65fa5784850","streamId":"AppTestStream","perfEndCommit":1415706624702,"perfPublishEvent":1415706624703,"perfPublishReceived":1415706624704,"perfSendToStore":1415706624704,"perfStoreReceived":1415706624707,"perfNotifyModelChange":1415706624707},"report":{"startTime":1415706628045,"endTime":null,"setId":"4bbbd3f7-4e5a-46af-9ca3-395b0070fcdd","setNumber":1},"data":[]}},"Completed":{"4bbbd3f7-4e5a-46af-9ca3-395b0070fcdd":{"_metadata":{"eventType":"PerfSetEnd","streamClientSent":1415706628172,"perfStreamReceived":1415706624827,"perfBeginCommit":1415706624827,"streamOrder":338,"eventId":"17f9dd29-d85e-478c-b610-4d4ae9a3a2f8","streamId":"AppTestStream","perfEndCommit":1415706624829,"perfPublishEvent":1415706624831,"perfPublishReceived":1415706624831,"perfSendToStore":1415706624831,"perfStoreReceived":1415706624832,"perfNotifyModelChange":1415706624832},"report":{"startTime":1415706628045,"endTime":1415706628172,"setId":"4bbbd3f7-4e5a-46af-9ca3-395b0070fcdd","setNumber":1,"sendToStream":303.2,"between1":0,"writeToDisk":17,"between2":5.6,"sendToBLP":0.4,"blpLogic":0,"sendToStore":1.6,"setModel":0,"sendToClient":3369.6,"totalTime":3697.4,"elapsedSec":0.127,"totalRecords":10,"recordsPerSec":78.74015748031496},"data":[{"perfClientSent":1415706624446,"startPerfRun":true,"runSize":10,"streamClientSent":1415706624447,"perfStreamReceived":1415706624670,"perfBeginCommit":1415706624670,"streamOrder":12052,"eventId":"207a2826-7788-41dd-8abc-4991b3477a83","streamId":"AppTestStream","perfEndCommit":1415706624673,"perfPublishEvent":1415706624675,"perfPublishReceived":1415706624676,"perfSendToStore":1415706624676,"perfStoreReceived":1415706624676,"perfNotifyModelChange":1415706624676,"perfClientReceived":1415706628045,"TotalTime":3599,"SendToStream":224,"Between1":0,"WriteToDisk":3,"Between2":2,"SendToBLP":1,"BLPlogic":0,"SendToStore":0,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624446,"startPerfRun":true,"runSize":10,"streamClientSent":1415706624447,"perfStreamReceived":1415706624670,"perfBeginCommit":1415706624670,"streamOrder":12052,"eventId":"207a2826-7788-41dd-8abc-4991b3477a83","streamId":"AppTestStream","perfEndCommit":1415706624673,"perfPublishEvent":1415706624675,"perfPublishReceived":1415706624676,"perfSendToStore":1415706624676,"perfStoreReceived":1415706624676,"perfNotifyModelChange":1415706624676,"perfClientReceived":1415706628045,"TotalTime":3599,"SendToStream":224,"Between1":0,"WriteToDisk":3,"Between2":2,"SendToBLP":1,"BLPlogic":0,"SendToStore":0,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624768,"perfBeginCommit":1415706624768,"streamOrder":12053,"eventId":"8540803d-8c31-4995-bd58-f7d60c0f9076","streamId":"AppTestStream","perfEndCommit":1415706624791,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624800,"perfNotifyModelChange":1415706624800,"perfClientReceived":1415706628169,"TotalTime":3720,"SendToStream":319,"Between1":0,"WriteToDisk":23,"Between2":8,"SendToBLP":0,"BLPlogic":0,"SendToStore":1,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624768,"perfBeginCommit":1415706624768,"streamOrder":12053,"eventId":"8540803d-8c31-4995-bd58-f7d60c0f9076","streamId":"AppTestStream","perfEndCommit":1415706624791,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624800,"perfNotifyModelChange":1415706624800,"perfClientReceived":1415706628169,"TotalTime":3720,"SendToStream":319,"Between1":0,"WriteToDisk":23,"Between2":8,"SendToBLP":0,"BLPlogic":0,"SendToStore":1,"SetModel":0,"SendToClient":3369},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624771,"perfBeginCommit":1415706624771,"streamOrder":12054,"eventId":"31af30c6-9fc0-463c-946b-b6ad21728ad1","streamId":"AppTestStream","perfEndCommit":1415706624792,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624801,"perfNotifyModelChange":1415706624801,"perfClientReceived":1415706628171,"TotalTime":3722,"SendToStream":322,"Between1":0,"WriteToDisk":21,"Between2":7,"SendToBLP":0,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624771,"perfBeginCommit":1415706624771,"streamOrder":12054,"eventId":"31af30c6-9fc0-463c-946b-b6ad21728ad1","streamId":"AppTestStream","perfEndCommit":1415706624792,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624801,"perfNotifyModelChange":1415706624801,"perfClientReceived":1415706628171,"TotalTime":3722,"SendToStream":322,"Between1":0,"WriteToDisk":21,"Between2":7,"SendToBLP":0,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624773,"perfBeginCommit":1415706624773,"streamOrder":12055,"eventId":"a79e5d64-6f10-4b6c-93f9-a11bd4a2af50","streamId":"AppTestStream","perfEndCommit":1415706624793,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":324,"Between1":0,"WriteToDisk":20,"Between2":6,"SendToBLP":0,"BLPlogic":0,"SendToStore":3,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624773,"perfBeginCommit":1415706624773,"streamOrder":12055,"eventId":"a79e5d64-6f10-4b6c-93f9-a11bd4a2af50","streamId":"AppTestStream","perfEndCommit":1415706624793,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624799,"perfSendToStore":1415706624799,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":324,"Between1":0,"WriteToDisk":20,"Between2":6,"SendToBLP":0,"BLPlogic":0,"SendToStore":3,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624776,"perfBeginCommit":1415706624776,"streamOrder":12056,"eventId":"ac10e31b-99ea-40ee-ac63-86bb5c692235","streamId":"AppTestStream","perfEndCommit":1415706624794,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624800,"perfSendToStore":1415706624800,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":327,"Between1":0,"WriteToDisk":18,"Between2":5,"SendToBLP":1,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370},{"perfClientSent":1415706624449,"streamClientSent":1415706624449,"perfStreamReceived":1415706624776,"perfBeginCommit":1415706624776,"streamOrder":12056,"eventId":"ac10e31b-99ea-40ee-ac63-86bb5c692235","streamId":"AppTestStream","perfEndCommit":1415706624794,"perfPublishEvent":1415706624799,"perfPublishReceived":1415706624800,"perfSendToStore":1415706624800,"perfStoreReceived":1415706624802,"perfNotifyModelChange":1415706624802,"perfClientReceived":1415706628172,"TotalTime":3723,"SendToStream":327,"Between1":0,"WriteToDisk":18,"Between2":5,"SendToBLP":1,"BLPlogic":0,"SendToStore":2,"SetModel":0,"SendToClient":3370}]}}}
    } 
};

var observers = {};
var channel = null;

var setupObservable = function(path){
    if(observers[path]) return;
    observers[path] = channel.of(path);
};

var getElement = function(pathArr, obj){

    if(obj === undefined){
        return null;
    }

    if(pathArr.length === 0){
        return obj;
    }

    var rest = pathArr.length > 1 ? pathArr.slice(1) : [];
    var currObj = obj[pathArr[0]];

    return getElement(rest, currObj);
};

var setElement = function(pathArr, val, obj, builtPath){

    var _newPath = builtPath + '/' + pathArr[0];
    //so we can notify interested parties
    setupObservable(_newPath);

    //we found it!!
    if(pathArr.length == 1){
        obj[pathArr[0]] = val;

        var _newVal = obj[pathArr[0]];

        if(_newVal._metadata){
            _newVal._metadata.perfNotifyModelChange = (new Date()).getTime();    
        }        

        observers[_newPath].emit('POST',_newVal);

        return val;
    }

    //we've never visited this node before, set it up
    if(obj[pathArr[0]] == undefined){
        obj[pathArr[0]] = {};
    }

    //keep going down the path
    var _nextNode = obj[pathArr[0]];
    setElement(pathArr.slice(1),val,_nextNode,_newPath);

    //notify after update
    if(observers[_newPath] != undefined){
        
        var _newVal = obj[pathArr[0]];

        if(_newVal._metadata){
            _newVal._metadata.perfNotifyModelChange = (new Date()).getTime();
        }        

        observers[_newPath].emit('POST',_newVal);
    }
};

exports.get = function(path){
    var _stripped = path.toString().replace(/^\/Store\//,'').split('\/');

    return getElement(_stripped,store);
};

exports.set = function(path, val){

    var _stripped = path.toString().replace(/^\/Store\//,'').split('\/');

    var toReturn = setElement(_stripped,val,store,'');

    return toReturn;
};

exports.setChannel = function(_channel){
    channel = _channel;
};

exports.setupObservable = setupObservable;
