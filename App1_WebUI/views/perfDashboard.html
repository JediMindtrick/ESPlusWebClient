<html ng-app="ESPlus">
<head>
	<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/dashboardTable.css">

    <style>
        thead, tbody { display: block; }

        tbody {
            overflow-y: auto;
            overflow-x: hidden;
        }
    </style>

    <script type="text/javascript" src="/javascripts/lodash.min.js"></script>
	<script type="text/javascript" src="/javascripts/socket.io.js"></script>
    <script type="text/javascript" src="/javascripts/angular.min.js"></script>
    <script type="text/javascript" src="/javascripts/angular-ui.min.js"></script>
    <script type="text/javascript" src="/javascripts/angular-ui-router.min.js"></script>
</head>
<body ng-controller="MainCtrl">

<div style="margin-left:50px;">
    <h1>ES+Realtime Model Push Performance Dashboard</h1>

    <label>Name: {{model.name}}</label><br />
    <label>Start: {{model.startTime}}</label><br />
    <label>End: {{model.endTime}}</label><br />

    <table class="CSSTableGenerator" style="height: 30px;">
        <tbody style="height:250px;">
            <tr>
                <td>#</td>
                <td>Stream Order</td>
                <td>Event Id</td>
                <td>Client Sent</td>
                <td>Stream Received</td>
                <td>Begin Commit</td>
                <td>End Commit</td>
                <td>Publish Event</td>
                <td>Publish Received</td>
                <td>Client Received</td>

            </tr>
            <tr ng-repeat="val in model.data track by $index | orderBy:streamOrder">
                <td>{{$index}}</td>
                <td>{{val.streamOrder}}</td>
                <td>{{val.eventId}}</td>
                <td>{{val.perfClientSent}}</td>
                <td>{{val.perfStreamReceived}}</td>
                <td>{{val.perfBeginCommit}}</td>
                <td>{{val.perfEndCommit}}</td>
                <td>{{val.perfPublishEvent}}</td>
                <td>{{val.perfPublishReceived}}</td>
                <td>{{val.perfClientReceived}}</td>
            </tr>
        </tbody>
    </table>

</div>

    <footer>
        <p>&copy; 2014, Brandon Wilhite</p>
    </footer>

<script type="text/javascript">

    function runScope(angularScope,callback){

		var result = void 0;
		var phase = angularScope.$root.$$phase;

		if(phase == '$apply' || phase == '$digest'){
			result = callback(angularScope);
		}else{
			angularScope.$apply(function(){
				result = callback(angularScope);
			});
		}

	    return result;
	}

</script>
<script type="text/javascript">

angular.module('ESPlus',[])
.controller('MainCtrl',['$scope','$http','$log',function($scope,$http,$log){

    $scope.model = [];

    $http.get('http://54.68.110.91\:6001/Store/TestOrg/current/0')
    .then(function(data){

//        $log.log('http success: ' + JSON.stringify(data));

        data.data.data = _.map(data.data.data,function(e){
            var evt = e._metadata;
            var _newEvt = {
                streamOrder: evt.streamOrder,
                eventId: evt.eventId,
                perfClientSent: 0,
                perfStreamReceived: evt.perfStreamReceived - evt.perfClientSent,
                perfBeginCommit: evt.perfBeginCommit - evt.perfStreamReceived,
                perfEndCommit: evt.perfEndCommit - evt.perfBeginCommit,
                perfPublishEvent: evt.perfPublishEvent - evt.perfEndCommit,
                perfPublishReceived: evt.perfPublishReceived - evt.perfPublishEvent,
                perfClientReceived: evt.perfClientReceived - evt.perfPublishReceived
            };
            return _newEvt;
        });

        $scope.model = data.data;
    })
    .catch(function(err){
        $log.log('http error: ' + JSON.stringify(err));
    });

}])

;

</script>

</body>
</html>
